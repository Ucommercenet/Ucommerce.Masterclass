@using Ucommerce
@using Ucommerce.Catalog.Models

@{
    Layout = "~/Views/shared/_Layout.cshtml";
}

<div class="container" id="app-checkout">
    <div class="row mt-4">
        <div class="col-8">
            <div class="row bg-light">
                    <legend>Address information</legend>
                    <div class="col-6">
                        <label for="billingfirstname" class="form-label">First name</label>
                        <input type="text" v-on:blur="update" v-model="CheckoutModel.AddressViewModel.FirstName" class="form-control" id="billingfirstname"></input>
                    </div>
                    <div class="col-6">
                        <label for="billinglastname" class="form-label">Last name</label>
                        <input type="text" v-on:blur="update" v-model="CheckoutModel.AddressViewModel.LastName" class="form-control" id="billinglastname"></input>
                    </div>
                    <div class="col-6">
                        <label for="billingaddress" class="form-label">Address</label>
                        <input type="text" v-on:blur="update" class="form-control" v-model="CheckoutModel.AddressViewModel.Line1" id="billingaddress"></input>
                    </div>
                    <div class="col-6">
                        <label for="billingcity" class="form-label">City</label>
                        <input type="text" v-on:blur="update" v-model="CheckoutModel.AddressViewModel.City" class="form-control" id="billingcity"></input>
                    </div>
                    <div class="col-6">
                        <label for="billingpostal" class="form-label">Postal Code</label>
                        <input type="text" v-on:blur="update" v-model="CheckoutModel.AddressViewModel.PostalCode" class="form-control" id="billingpostal"></input>
                    </div>
                    <div class="col-6">
                        <label for="billingcountry" class="form-label">Country</label>
                           <select v-on:blur="update" name="" id="billingcountry" v-model="CheckoutModel.AddressViewModel.Country" class="form-control">
                             <option value="" disabled>Select a country</option> 
                             <option :value="country" v-for="country in CheckoutModel.Countries">{{ country.Name }}</option> 
                          </select> 
                    </div>
                    <div class="col-6">
                        <label for="billingemail" class="form-label">Email</label>
                        <input type="text" v-on:blur="update" v-model="CheckoutModel.AddressViewModel.EmailAddress" class="form-control" id="billingemail"></input>
                    </div>
                    <div class="col-6">
                        <label for="billingphone" class="form-label">Phone</label>
                        <input v-on:blur="update" v-model="CheckoutModel.AddressViewModel.PhoneNumber" type="text" class="form-control" id="billingphone"></input>
                    </div>
            </div>
        </div>
        <div class="col-4">
            <div class="row">
                <div class="col-md-12 bg-light">
                    <legend>Shipping Method</legend>
                    <div v-for="shippingMethod in CheckoutModel.ShippingViewModel.AvailableShippingMethods">
                        <input :value="shippingMethod" type="radio" v-model="CheckoutModel.ShippingViewModel.SelectedShippingMethod" /> {{ shippingMethod.Name }} 
                    </div>
                </div> 
            </div>
            <div class="row">
                <div class="col-md-12 bg-light">
                    <legend>Payment Method</legend>
                    <div v-for="paymentMethod in CheckoutModel.PaymentViewModel.AvailablePaymentMethods">
                        <input :value="paymentMethod" type="radio" v-model="CheckoutModel.PaymentViewModel.SelectedPaymentMethod" /> {{ paymentMethod.Name }} 
                    </div>
                </div>
            </div>

            <div class="row">
                <button class="btn btn-primary">Complete Order - {{CheckoutModel.OrderTotal}}</button>
            </div>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.24.0/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
<script>
    var app = new Vue({
      el: '#app-checkout',
      data: {
        CheckoutModel: {
          AddressViewModel: {
            Country: {
              
            },
          }
        }
      },
      methods: {
        update: function(e){
            axios.post('/umbraco/api/checkout/update',this.CheckoutModel).then(response => { this.CheckoutModel = response.data; });
        }
      },
      beforeMount(){    
          axios.get('/umbraco/api/checkout/get').then(response => { this.CheckoutModel = response.data; } ); 
       },
    })
</script>